<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>üîß ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏£‡∏∞‡∏ö‡∏ö Admin</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
    }

    .container {
      max-width: 800px;
      margin: 0 auto;
      background: white;
      border-radius: 20px;
      padding: 30px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
    }

    h1 {
      color: #667eea;
      margin-bottom: 10px;
    }

    .section {
      margin: 30px 0;
      padding: 20px;
      border: 2px solid #e0e0e0;
      border-radius: 10px;
    }

    .section h2 {
      color: #333;
      margin-bottom: 15px;
    }

    .status {
      padding: 10px 15px;
      border-radius: 8px;
      margin: 10px 0;
      font-weight: 600;
    }

    .status.success {
      background: #e8f5e9;
      color: #2e7d32;
      border-left: 4px solid #4caf50;
    }

    .status.error {
      background: #ffebee;
      color: #c62828;
      border-left: 4px solid #f44336;
    }

    .status.warning {
      background: #fff3e0;
      color: #e65100;
      border-left: 4px solid #ff9800;
    }

    .status.info {
      background: #e3f2fd;
      color: #1565c0;
      border-left: 4px solid #2196f3;
    }

    button {
      padding: 12px 24px;
      background: #667eea;
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 1em;
      font-weight: 600;
      margin: 5px;
      transition: all 0.3s;
    }

    button:hover {
      background: #764ba2;
      transform: translateY(-2px);
    }

    button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .code {
      background: #f5f5f5;
      padding: 15px;
      border-radius: 8px;
      font-family: 'Courier New', monospace;
      margin: 10px 0;
      overflow-x: auto;
    }

    .links {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-top: 20px;
    }

    .links a {
      padding: 10px 20px;
      background: #4caf50;
      color: white;
      text-decoration: none;
      border-radius: 8px;
      font-weight: 600;
      transition: all 0.3s;
    }

    .links a:hover {
      background: #45a049;
      transform: translateY(-2px);
    }
  </style>
</head>
<body>

  <div class="container">
    <h1>üîß ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏£‡∏∞‡∏ö‡∏ö Admin</h1>
    <p>‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏£‡∏∞‡∏ö‡∏ö‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà</p>

    <!-- Section 1: Firebase Connection -->
    <div class="section">
      <h2>1Ô∏è‚É£ ‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Firebase</h2>
      <div id="firebaseStatus" class="status info">‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö...</div>
      <button onclick="testFirebase()">‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á</button>
    </div>

    <!-- Section 2: Authentication Status -->
    <div class="section">
      <h2>2Ô∏è‚É£ ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ Authentication</h2>
      <div id="authStatus" class="status info">‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö...</div>
      <div id="userInfo"></div>
    </div>

    <!-- Section 3: Test Login -->
    <div class="section">
      <h2>3Ô∏è‚É£ ‡∏ó‡∏î‡∏™‡∏≠‡∏ö Login</h2>
      <div style="margin: 15px 0;">
        <input 
          type="email" 
          id="testEmail" 
          placeholder="‡∏≠‡∏µ‡πÄ‡∏°‡∏• (‡πÄ‡∏ä‡πà‡∏ô admin@feiyi.com)"
          style="width: 100%; padding: 12px; border: 2px solid #e0e0e0; border-radius: 8px; margin-bottom: 10px;"
        >
        <input 
          type="password" 
          id="testPassword" 
          placeholder="‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô"
          style="width: 100%; padding: 12px; border: 2px solid #e0e0e0; border-radius: 8px; margin-bottom: 10px;"
        >
        <button onclick="testLogin()">üîê ‡∏ó‡∏î‡∏™‡∏≠‡∏ö Login</button>
        <button onclick="testLogout()">üö™ ‡∏ó‡∏î‡∏™‡∏≠‡∏ö Logout</button>
      </div>
      <div id="loginStatus"></div>
    </div>

    <!-- Section 4: Files Check -->
    <div class="section">
      <h2>4Ô∏è‚É£ ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÑ‡∏ü‡∏•‡πå</h2>
      <div id="filesStatus" class="status info">‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö...</div>
      <button onclick="checkFiles()">‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÑ‡∏ü‡∏•‡πå</button>
    </div>

    <!-- Section 5: Quick Links -->
    <div class="section">
      <h2>5Ô∏è‚É£ ‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏î‡πà‡∏ß‡∏ô</h2>
      <div class="links">
        <a href="admin-login.html" target="_blank">üîê Login Page</a>
        <a href="dashboard.html" target="_blank">üìä Dashboard</a>
        <a href="members.html" target="_blank">‚≠ê Members</a>
        <a href="index.html" target="_blank">üè† Home</a>
      </div>
    </div>

    <!-- Section 6: Setup Instructions -->
    <div class="section">
      <h2>6Ô∏è‚É£ ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á</h2>
      <ol style="line-height: 2;">
        <li>‚úÖ ‡πÄ‡∏õ‡∏¥‡∏î Firebase Authentication (Email/Password)</li>
        <li>‚úÖ ‡∏™‡∏£‡πâ‡∏≤‡∏á Admin User ‡πÉ‡∏ô Firebase Console</li>
        <li>‚úÖ ‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î (11 ‡πÑ‡∏ü‡∏•‡πå)</li>
        <li>‚úÖ Refresh ‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö (Ctrl+Shift+R)</li>
        <li>‚úÖ ‡∏ó‡∏î‡∏™‡∏≠‡∏ö Login ‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏ô‡∏µ‡πâ</li>
      </ol>
    </div>
  </div>

  <script type="module">
    import { auth, db } from './js/firebase.js';
    import { 
      signInWithEmailAndPassword, 
      signOut, 
      onAuthStateChanged 
    } from 'https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js';

    // Make functions global
    window.auth = auth;
    window.db = db;
    window.signInWithEmailAndPassword = signInWithEmailAndPassword;
    window.signOut = signOut;
    window.onAuthStateChanged = onAuthStateChanged;

    // Test Firebase Connection
    window.testFirebase = () => {
      const statusDiv = document.getElementById('firebaseStatus');
      
      try {
        if (auth && db) {
          statusDiv.className = 'status success';
          statusDiv.innerHTML = `
            ‚úÖ <strong>Firebase ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!</strong><br>
            <small>Project: ${auth.app.options.projectId}</small>
          `;
        } else {
          statusDiv.className = 'status error';
          statusDiv.innerHTML = '‚ùå <strong>‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Firebase</strong><br>‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö firebase.js';
        }
      } catch (error) {
        statusDiv.className = 'status error';
        statusDiv.innerHTML = `‚ùå <strong>Error:</strong> ${error.message}`;
      }
    };

    // Check Auth Status
    onAuthStateChanged(auth, (user) => {
      const statusDiv = document.getElementById('authStatus');
      const userInfoDiv = document.getElementById('userInfo');
      
      if (user) {
        statusDiv.className = 'status success';
        statusDiv.innerHTML = '‚úÖ <strong>‡∏Ñ‡∏∏‡∏ì Login ‡∏≠‡∏¢‡∏π‡πà!</strong>';
        
        userInfoDiv.innerHTML = `
          <div class="code">
            üìß ‡∏≠‡∏µ‡πÄ‡∏°‡∏•: ${user.email}<br>
            üÜî UID: ${user.uid}<br>
            ‚è∞ Login: ${new Date().toLocaleString('th-TH')}
          </div>
        `;
      } else {
        statusDiv.className = 'status warning';
        statusDiv.innerHTML = '‚ö†Ô∏è <strong>‡∏Ñ‡∏∏‡∏ì‡∏¢‡∏±‡∏á Login!</strong>';
        userInfoDiv.innerHTML = '';
      }
    });

    // Test Login
    window.testLogin = async () => {
      const email = document.getElementById('testEmail').value.trim();
      const password = document.getElementById('testPassword').value;
      const statusDiv = document.getElementById('loginStatus');

      if (!email || !password) {
        statusDiv.className = 'status error';
        statusDiv.innerHTML = '‚ùå ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡πÅ‡∏•‡∏∞‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô';
        return;
      }

      try {
        statusDiv.className = 'status info';
        statusDiv.innerHTML = '‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á Login...';

        const userCredential = await signInWithEmailAndPassword(auth, email, password);
        
        statusDiv.className = 'status success';
        statusDiv.innerHTML = `
          ‚úÖ <strong>Login ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!</strong><br>
          <small>‡∏≠‡∏µ‡πÄ‡∏°‡∏•: ${userCredential.user.email}</small>
        `;

      } catch (error) {
        statusDiv.className = 'status error';
        
        let errorMsg = '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î';
        
        if (error.code === 'auth/invalid-credential') {
          errorMsg = '‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏´‡∏£‡∏∑‡∏≠‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á';
        } else if (error.code === 'auth/user-not-found') {
          errorMsg = '‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ô‡∏µ‡πâ‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö<br><small>‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏™‡∏£‡πâ‡∏≤‡∏á Admin User ‡πÉ‡∏ô Firebase Console</small>';
        } else if (error.code === 'auth/configuration-not-found') {
          errorMsg = 'Firebase Authentication ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô<br><small>‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏õ‡∏¥‡∏î Email/Password ‡πÉ‡∏ô Firebase Console</small>';
        }
        
        statusDiv.innerHTML = `
          ‚ùå <strong>${errorMsg}</strong><br>
          <small>Error code: ${error.code}</small>
        `;
      }
    };

    // Test Logout
    window.testLogout = async () => {
      const statusDiv = document.getElementById('loginStatus');
      
      try {
        await signOut(auth);
        statusDiv.className = 'status success';
        statusDiv.innerHTML = '‚úÖ <strong>Logout ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!</strong>';
      } catch (error) {
        statusDiv.className = 'status error';
        statusDiv.innerHTML = `‚ùå <strong>Error:</strong> ${error.message}`;
      }
    };

    // Check Files
    window.checkFiles = async () => {
      const statusDiv = document.getElementById('filesStatus');
      statusDiv.className = 'status info';
      statusDiv.innerHTML = '‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÑ‡∏ü‡∏•‡πå...';

      const files = [
        'admin-login.html',
        'members.html',
        'js/auth.js',
        'js/members.js'
      ];

      let results = '<div class="code">';
      let allSuccess = true;

      for (const file of files) {
        try {
          const response = await fetch(file, { method: 'HEAD' });
          if (response.ok) {
            results += `‚úÖ ${file}<br>`;
          } else {
            results += `‚ùå ${file} (Not Found)<br>`;
            allSuccess = false;
          }
        } catch (error) {
          results += `‚ùå ${file} (Error)<br>`;
          allSuccess = false;
        }
      }

      results += '</div>';

      if (allSuccess) {
        statusDiv.className = 'status success';
        statusDiv.innerHTML = '<strong>‚úÖ ‡πÑ‡∏ü‡∏•‡πå‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô!</strong>' + results;
      } else {
        statusDiv.className = 'status error';
        statusDiv.innerHTML = '<strong>‚ùå ‡πÑ‡∏ü‡∏•‡πå‡πÑ‡∏°‡πà‡∏Ñ‡∏£‡∏ö!</strong>' + results;
      }
    };

    // Auto-run tests
    testFirebase();
    checkFiles();
  </script>

</body>
</html>
