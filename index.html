<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>üöê ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏≠‡∏á‡∏Ñ‡∏¥‡∏ß‡∏£‡∏ñ | Fei Yi Transporter</title>
  
  <!-- SEO -->
  <meta name="description" content="‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏≠‡∏á‡∏Ñ‡∏¥‡∏ß‡∏£‡∏ñ‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå Fei Yi Transporter ‡∏à‡∏≠‡∏á‡∏á‡πà‡∏≤‡∏¢ ‡∏™‡∏∞‡∏î‡∏ß‡∏Å ‡∏£‡∏ß‡∏î‡πÄ‡∏£‡πá‡∏ß">
  
  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@400;600;700&display=swap" rel="stylesheet">
  
  <!-- Style -->
  <link rel="stylesheet" href="css/style.css">
  <link rel="stylesheet" href="css/modal.css">
</head>
<body>

  <!-- ===== Header ===== -->
  <header>
    <h1>üöê Fei Yi Transporter</h1>
    <p>‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏≠‡∏á‡∏Ñ‡∏¥‡∏ß‡∏£‡∏ñ‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå</p>
  </header>

  <!-- ===== Main ===== -->
  <main>

    <!-- ===== ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏£‡∏≤‡∏Ñ‡∏≤ ===== -->
    <section class="card price-type-card">
      <h2>üí∞ ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏£‡∏≤‡∏Ñ‡∏≤</h2>
      
      <div class="price-type-buttons">
        <button class="price-btn customer-btn active" onclick="selectPriceType('customer')">
          <span class="icon">üë§</span>
          <div class="price-info">
            <span class="text">‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ</span>
            <span class="price-detail">‡∏£‡∏≤‡∏Ñ‡∏≤‡πÄ‡∏ï‡πá‡∏° 100%</span>
          </div>
        </button>
        
        <button class="price-btn member-btn" onclick="selectPriceType('member')">
          <span class="icon">‚≠ê</span>
          <div class="price-info">
            <span class="text">‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</span>
            <span class="price-detail">‡∏£‡∏±‡∏ö‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î‡∏û‡∏¥‡πÄ‡∏®‡∏©</span>
          </div>
        </button>
      </div>

      <div style="text-align: center; margin-top: 15px;">
        <a href="register-member.html" style="color: #FF9800; text-decoration: none; font-weight: 600;">
          ‚≠ê ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏õ‡πá‡∏ô‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å? ‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡πÄ‡∏•‡∏¢!
        </a>
      </div>
    </section>

    <!-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏≠‡∏ö‡∏£‡∏ñ -->
    <section class="card">
      <h2>üìç ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏≠‡∏ö‡∏£‡∏ñ</h2>

      <label for="tripSelect">‡∏£‡∏≠‡∏ö‡∏£‡∏ñ‡∏ó‡∏µ‡πà‡∏°‡∏µ</label>
      <select id="tripSelect">
        <option value="">-- ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏≠‡∏ö‡∏£‡∏ñ --</option>
      </select>

      <!-- ‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏≤‡∏Ñ‡∏≤ -->
      <div id="priceDisplay" class="price-display hidden">
        <div class="price-row">
          <span class="price-label">üí∞ ‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ï‡πà‡∏≠‡∏ó‡∏µ‡πà‡∏ô‡∏±‡πà‡∏á:</span>
          <span id="pricePerSeat" class="price-value">‡∏ø0</span>
        </div>
        <div class="price-row" id="discountRow" style="display: none;">
          <span class="price-label">üéÅ ‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å:</span>
          <span id="discountAmount" class="discount-value">-‡∏ø0</span>
        </div>
        <div class="price-row total-row">
          <span class="price-label"><strong>‡∏£‡∏ß‡∏° (1 ‡∏ó‡∏µ‡πà‡∏ô‡∏±‡πà‡∏á):</strong></span>
          <span id="totalPrice" class="total-value">‡∏ø0</span>
        </div>
      </div>
    </section>

    <!-- ‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏à‡∏≠‡∏á -->
    <section class="card">
      <h2>üìù ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡∏à‡∏≠‡∏á</h2>

      <label for="name">‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏à‡∏≠‡∏á</label>
      <input
        type="text"
        id="name"
        placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•"
        autocomplete="name"
      >

      <label for="phone">‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå</label>
      <input
        type="tel"
        id="phone"
        placeholder="0812345678"
        autocomplete="tel"
        maxlength="10"
      >
      
      <!-- ‡πÅ‡∏™‡∏î‡∏á‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å -->
      <div id="memberCheckStatus" style="display: none; margin-top: 8px; padding: 10px; border-radius: 8px; font-size: 0.9em;">
        <span id="memberCheckIcon"></span>
        <span id="memberCheckText"></span>
      </div>

      <label for="seats">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏ô‡∏±‡πà‡∏á‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á</label>
      <input
        type="number"
        id="seats"
        placeholder="‡πÄ‡∏ä‡πà‡∏ô 2"
        min="1"
      >

      <button id="bookBtn">‚úÖ ‡∏à‡∏≠‡∏á‡∏Ñ‡∏¥‡∏ß‡πÄ‡∏•‡∏¢</button>
    </section>

  </main>

  <!-- ===== Footer ===== -->
  <footer>
    <div class="footer-content">
      <p class="copyright">¬© 2025 Fei Yi Transporter</p>
      
      <div class="footer-buttons">
        <a href="dashboard.html" class="footer-btn admin-btn">
          üîê Admin
        </a>
        <a href="tel:0812345678" class="footer-btn contact-btn">
          üìû ‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡∏™‡∏≠‡∏ö‡∏ñ‡∏≤‡∏°
        </a>
        <a href="#" class="footer-btn line-btn" onclick="alert('‡πÄ‡∏û‡∏¥‡πà‡∏° LINE ID ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà'); return false;">
          üí¨ LINE Official
        </a>
      </div>
    </div>
  </footer>

  <!-- ===== Scripts ===== -->
  <script src="js/modal.js"></script>
  <script type="module" src="js/firebase.js"></script>
  <script type="module" src="js/app.js"></script>
  
  <script>
    // ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏£‡∏≤‡∏Ñ‡∏≤
    window.currentPriceType = 'customer'; // default - ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡πá‡∏ô global
    let currentBasePrice = 0;
    let currentMemberDiscount = 0; // ‡πÄ‡∏õ‡∏≠‡∏£‡πå‡πÄ‡∏ã‡πá‡∏ô‡∏ï‡πå
    let checkMemberTimeout = null; // ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö debounce

    function selectPriceType(type) {
      const buttons = document.querySelectorAll('.price-btn');
      buttons.forEach(btn => btn.classList.remove('active'));
      
      window.currentPriceType = type; // ‡πÄ‡∏Å‡πá‡∏ö‡πÉ‡∏ô window object
      
      if (type === 'customer') {
        document.querySelector('.customer-btn').classList.add('active');
        console.log('Selected: ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ (‡∏£‡∏≤‡∏Ñ‡∏≤‡πÄ‡∏ï‡πá‡∏°)');
      } else if (type === 'member') {
        document.querySelector('.member-btn').classList.add('active');
        console.log('Selected: ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å (‡∏£‡∏±‡∏ö‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î)');
      }
      
      // ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏≠‡∏ö‡∏£‡∏ñ‡πÅ‡∏•‡πâ‡∏ß
      updatePriceDisplay();
    }

    function updatePriceDisplay() {
      const tripSelect = document.getElementById('tripSelect');
      const selectedOption = tripSelect.options[tripSelect.selectedIndex];
      
      if (!selectedOption || !selectedOption.value) {
        document.getElementById('priceDisplay').classList.add('hidden');
        return;
      }

      const basePrice = Number(selectedOption.dataset.price) || 0;
      const memberDiscount = Number(selectedOption.dataset.memberDiscount) || 0;
      
      currentBasePrice = basePrice;
      currentMemberDiscount = memberDiscount;
      
      if (basePrice > 0) {
        document.getElementById('priceDisplay').classList.remove('hidden');
        
        // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏£‡∏≤‡∏Ñ‡∏≤
        const isMember = window.currentPriceType === 'member';
        const discountAmount = isMember ? Math.round(basePrice * (memberDiscount / 100)) : 0;
        const finalPrice = basePrice - discountAmount;
        
        // ‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏≤‡∏Ñ‡∏≤
        document.getElementById('pricePerSeat').textContent = `‡∏ø${basePrice.toLocaleString()}`;
        
        // ‡πÅ‡∏™‡∏î‡∏á/‡∏ã‡πà‡∏≠‡∏ô‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î
        const discountRow = document.getElementById('discountRow');
        if (isMember && discountAmount > 0) {
          discountRow.style.display = 'flex';
          document.getElementById('discountAmount').textContent = `-‡∏ø${discountAmount.toLocaleString()} (${memberDiscount}%)`;
        } else {
          discountRow.style.display = 'none';
        }
        
        document.getElementById('totalPrice').textContent = `‡∏ø${finalPrice.toLocaleString()}`;
      }
    }

    // ===== ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£ =====
    async function checkMemberStatus(phone) {
      const statusDiv = document.getElementById('memberCheckStatus');
      const iconSpan = document.getElementById('memberCheckIcon');
      const textSpan = document.getElementById('memberCheckText');
      
      // ‡∏ã‡πà‡∏≠‡∏ô‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏ñ‡πâ‡∏≤‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÑ‡∏°‡πà‡∏Ñ‡∏£‡∏ö 10 ‡∏´‡∏•‡∏±‡∏Å
      if (phone.length !== 10 || !/^0[0-9]{9}$/.test(phone)) {
        statusDiv.style.display = 'none';
        return;
      }

      try {
        // Import Firebase functions
        const { collection, query, where, getDocs } = await import("https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js");
        const { db } = await import("./js/firebase.js");

        // ‡πÅ‡∏™‡∏î‡∏á‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö
        statusDiv.style.display = 'block';
        statusDiv.style.background = '#e3f2fd';
        statusDiv.style.borderLeft = '4px solid #2196F3';
        iconSpan.textContent = 'üîç ';
        textSpan.textContent = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å...';

        // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÉ‡∏ô‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
        const memberQuery = query(
          collection(db, "members"), 
          where("phone", "==", phone)
        );
        const memberSnapshot = await getDocs(memberQuery);

        if (!memberSnapshot.empty) {
          // ‡∏û‡∏ö‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å
          const memberData = memberSnapshot.docs[0].data();
          
          statusDiv.style.background = '#e8f5e9';
          statusDiv.style.borderLeft = '4px solid #4caf50';
          iconSpan.textContent = '‚≠ê ';
          textSpan.innerHTML = `<strong>‡∏û‡∏ö‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å:</strong> ${memberData.fullName}<br><small style="color: #2e7d32;">‡∏à‡∏∞‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥</small>`;
          
          // ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
          if (window.currentPriceType !== 'member') {
            selectPriceType('member');
          }
        } else {
          // ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å
          statusDiv.style.background = '#fff3e0';
          statusDiv.style.borderLeft = '4px solid #ff9800';
          iconSpan.textContent = '‚ÑπÔ∏è ';
          textSpan.innerHTML = `<strong>‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</strong><br><small style="color: #e65100;">‡∏à‡∏≠‡∏á‡∏î‡πâ‡∏ß‡∏¢‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ ‡∏´‡∏£‡∏∑‡∏≠ <a href="register-member.html" style="color: #ff9800; font-weight: 600;">‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</a></small>`;
          
          // ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
          if (window.currentPriceType !== 'customer') {
            selectPriceType('customer');
          }
        }

      } catch (error) {
        console.error("Error checking member:", error);
        statusDiv.style.display = 'none';
      }
    }

    // ‡πÄ‡∏û‡∏¥‡πà‡∏° event listener ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£
    document.addEventListener('DOMContentLoaded', function() {
      const phoneInput = document.getElementById('phone');
      
      if (phoneInput) {
        phoneInput.addEventListener('input', function(e) {
          // ‡∏•‡∏ö‡∏≠‡∏±‡∏Å‡∏Ç‡∏£‡∏∞‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç
          this.value = this.value.replace(/[^0-9]/g, '');
          
          const phone = this.value.trim();
          
          // ‡πÉ‡∏ä‡πâ debounce ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å API ‡∏ö‡πà‡∏≠‡∏¢‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ
          clearTimeout(checkMemberTimeout);
          
          if (phone.length === 10) {
            checkMemberTimeout = setTimeout(() => {
              checkMemberStatus(phone);
            }, 500); // ‡∏£‡∏≠ 0.5 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ
          } else {
            // ‡∏ã‡πà‡∏≠‡∏ô‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏ñ‡πâ‡∏≤‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÑ‡∏°‡πà‡∏Ñ‡∏£‡∏ö
            document.getElementById('memberCheckStatus').style.display = 'none';
          }
        });

        // ‡πÄ‡∏°‡∏∑‡πà‡∏≠ blur (‡∏Ñ‡∏•‡∏¥‡∏Å‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å input)
        phoneInput.addEventListener('blur', function() {
          const phone = this.value.trim();
          if (phone.length === 10) {
            checkMemberStatus(phone);
          }
        });
      }

      const tripSelect = document.getElementById('tripSelect');
      if (tripSelect) {
        tripSelect.addEventListener('change', updatePriceDisplay);
      }
    });
    
    // Export functions for global access
    window.selectPriceType = selectPriceType;
    window.updatePriceDisplay = updatePriceDisplay;
    window.checkMemberStatus = checkMemberStatus;
  </script>

</body>
</html>
